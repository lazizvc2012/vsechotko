<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Сложный 2D Minecraft на HTML</title>
<style>
  body { margin: 0; overflow: hidden; font-family: sans-serif; background: #87ceeb; }
  canvas { background: #87ceeb; display: block; margin: 0 auto; }
  #inventory {
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px;
    display: flex; gap: 10px;
  }
  .slot {
    width: 40px; height: 40px; border: 2px solid white; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    background: #444;
  }
  .slot.selected { border-color: yellow; }
  .block-icon {
    width: 32px; height: 32px;
  }
</style>
</head>
<body>
<canvas id="game" width="640" height="480"></canvas>
<div id="inventory"></div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const tileSize = 32;
const mapWidth = 20;
const mapHeight = 15;

// Типы блоков (0 - воздух)
const BLOCKS = {
  0: {color: null, name: 'Пусто'},
  1: {color: '#228B22', name: 'Трава'},     // трава
  2: {color: '#8B4513', name: 'Дерево'},   // дерево
  3: {color: '#808080', name: 'Камень'}    // камень
};

let map = [];
// Генерация карты с травой и деревом
function generateMap() {
  for (let y = 0; y < mapHeight; y++) {
    map[y] = [];
    for (let x = 0; x < mapWidth; x++) {
      if (y > 10) map[y][x] = 3; // камень внизу
      else if (y === 10) map[y][x] = 1; // слой травы
      else if (y === 9 && Math.random() > 0.9) map[y][x] = 2; // случайное дерево
      else map[y][x] = 0; // воздух
    }
  }
}

generateMap();

let player = {
  x: 5,
  y: 8,
  width: tileSize,
  height: tileSize,
  color: '#FF4500'
};

const inventory = [1, 2, 3];
let selectedBlock = 1;

const inventoryDiv = document.getElementById('inventory');

function drawMap() {
  for (let y = 0; y < mapHeight; y++) {
    for (let x = 0; x < mapWidth; x++) {
      const block = map[y][x];
      if(block !== 0) {
        ctx.fillStyle = BLOCKS[block].color;
        ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
        ctx.strokeStyle = '#000';
        ctx.strokeRect(x * tileSize, y * tileSize, tileSize, tileSize);
      }
    }
  }
}

function drawPlayer() {
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x * tileSize, player.y * tileSize, player.width, player.height);
}

function drawInventory() {
  inventoryDiv.innerHTML = '';
  inventory.forEach((block, index) => {
    const slot = document.createElement('div');
    slot.className = 'slot' + (block === selectedBlock ? ' selected' : '');
    slot.title = BLOCKS[block].name;
    slot.onclick = () => {
      selectedBlock = block;
      drawInventory();
    };
    const icon = document.createElement('div');
    icon.style.width = '32px';
    icon.style.height = '32px';
    icon.style.backgroundColor = BLOCKS[block].color;
    icon.className = 'block-icon';
    slot.appendChild(icon);
    inventoryDiv.appendChild(slot);
  });
}

document.addEventListener('keydown', e => {
  let nx = player.x;
  let ny = player.y;
  if (e.key === 'w') ny -= 1;
  else if (e.key === 's') ny += 1;
  else if (e.key === 'a') nx -= 1;
  else if (e.key === 'd') nx += 1;

  // Проверка, что игрок не идёт в блок (стена)
  if (nx >= 0 && nx < mapWidth && ny >= 0 && ny < mapHeight) {
    if (map[ny][nx] === 0) {
      player.x = nx;
      player.y = ny;
    }
  }
});

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const mx = Math.floor((e.clientX - rect.left) / tileSize);
  const my = Math.floor((e.clientY - rect.top) / tileSize);

  // Если клик по позиции рядом с игроком - либо поставим, либо удалим блок
  const distX = Math.abs(mx - player.x);
  const distY = Math.abs(my - player.y);

  if (distX <= 1 && distY <= 1) {
    if (map[my][mx] === 0) {
      // Поставить блок
      map[my][mx] = selectedBlock;
    } else {
      // Удалить блок
      map[my][mx] = 0;
    }
  }
});

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMap();
  drawPlayer();
  drawInventory();
  requestAnimationFrame(gameLoop);
}

drawInventory();
gameLoop();
</script>
</body>
</html>
